# 🚀 DevOps QR Code Generator - Kubernetes Deployment with AWS IRSA

This project demonstrates how to deploy a QR Code Generator application on Kubernetes (EKS) with secure access to AWS S3 using IAM Roles for Service Accounts (IRSA).

## 📦 Project Overview

The application consists of two main components:

- **Front-End**: A Next.js application for user interaction.
- **Back-End API**: A FastAPI server that accepts URLs, generates QR codes, and stores them in AWS S3.

All components are containerized using Docker and deployed on Amazon EKS using Kubernetes manifests (Deployments, Services, ConfigMaps, and IRSA-integrated ServiceAccounts).

---

## 🧱 Architecture Overview

```text
User
 │
 ▼
Frontend (Next.js)
 │
 ▼
Backend (FastAPI) ──(IRSA)──▶ IAM Role
        │                     │
        └──▶ AWS S3
```

---

## 🧩 Components

### Frontend:
- Provides a UI to submit URLs and view generated QR codes.

### Backend:
- Handles URL input, generates QR codes, and stores images in S3 using IRSA to securely access AWS.

### Kubernetes:
- Deploys both services using Deployments.
- Uses a Kubernetes ServiceAccount (IRSA) with an attached IAM policy for accessing AWS S3 securely.

### AWS S3:
- Stores QR code images generated by the backend.

---

## ✅ Prerequisites

Ensure the following tools and services are set up:

- 🐳 **Docker**
- ☸️ **kubectl**
- 🌩️ **AWS CLI**
- 🧪 **eksctl**
- 🧬 **Git**

Additional requirements:
- ✅ A running **EKS cluster**
- ✅ An **S3 bucket** for storing QR codes

---

## ☁️ Setting Up AWS IRSA for Secure S3 Access

### 1. Associate IAM OIDC Provider with EKS

To enable IRSA for your EKS cluster, you need to associate an OIDC provider with your EKS cluster. Follow these steps:

```bash
eksctl utils associate-iam-oidc-provider \
  --region ap-south-1 \
  --cluster devops-qr-cluster \
  --approve
```

### 2. Create IAM Policy (S3 + SecretsManager Access)
```bash
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "S3AccessForQRGenerator",
            "Effect": "Allow",
            "Action": [
                "s3:GetObject",
                "s3:PutObject",
                "s3:ListBucket"
            ],
            "Resource": [
                "arn:aws:s3:::rahulverse-devops-qr-codes",
                "arn:aws:s3:::rahulverse-devops-qr-codes/*"
            ]
        }
    ]
}
```

Create this policy in AWS IAM (name: QRGenerator-S3-Policy).

### 3. Create IAM Role & ServiceAccount using IRSA
To allow Kubernetes workloads to assume the IAM role and access the S3 bucket, create a ServiceAccount that is associated with the IAM role:
```bash
eksctl create iamserviceaccount \
  --name aws-secrets-sa \
  --cluster devops-qr-cluster \
  --region ap-south-1 \
  --attach-policy-arn arn:aws:iam::<Account-ID>:policy/QRGenerator-S3-Policy \
  --approve \
  --override-existing-serviceaccounts
```
This creates a Kubernetes service account (aws-secrets-sa) that assumes an IAM role with access to S3 and Secrets Manager.

---
## 📁 Project Structure

```bash
k8s-ISRA/
├── README.md
├── configmap.yaml
├── backend-deployment.yaml
└── frontend-deployment.yaml
```

---
### ⚙️ Kubernetes Deployment Steps
 
1. Update Kubeconfig
```bash
aws eks update-kubeconfig --region ap-south-1 --name devops-qr-cluster
```
2. Apply ConfigMap
```bash
kubectl apply -f configmap.yaml
```

3. Deploy Backend (with IRSA-enabled SA)
```bash
kubectl apply -f backend-deployment.yaml
```

4. Deploy Frontend
```bash
kubectl apply -f frontend-deployment.yaml
```

5. Verify Everything is Running
```bash
kubectl get all
```

6. Access the Frontend
```bash
kubectl get svc qr-generator-frontend-service
```
Use the minikube command (if running locally) or check the ELB URL (if using EKS with LoadBalancer service type):

---
## 🧹 Clean-Up Resources
```bash
Delete Kubernetes Resources
kubectl delete -f backend-deployment.yaml
kubectl delete -f frontend-deployment.yaml
kubectl delete -f configmap.yaml
```

Delete ServiceAccount & IAM Role
```bash
eksctl delete iamserviceaccount \
  --name aws-secrets-sa \
  --cluster devops-qr-cluster \
  --region ap-south-1
```
---
## 📌 Useful Commands
| Task                                | Command                                   |
| ----------------------------------- | ----------------------------------------- |
| Get all resources                   | `kubectl get all`                         |
| Describe pod                        | `kubectl describe pod <pod-name>`         |
| View logs                           | `kubectl logs <pod-name>`                 |
| Exec into container                 | `kubectl exec -it <pod-name> -- /bin/sh`  |
| Delete all deployments and services | `kubectl delete deploy,svc,rs,pods --all` |

---
## 🧑‍💻 Development & Customization

You can modify the following components to suit your needs:

- **Dockerfiles**:  
  Update app versions or tweak the build process.

- **Kubernetes Manifests**:  
  Adjust replicas, resource limits, or environment variables for scaling or customization.

- **IAM Policy**:  
  Modify the IAM policy to follow the least-privilege model for better security.

---

## 📝 License

MIT License © 2025 Rahul Paswan
This project is licensed under the [MIT License](./LICENSE).















